#!/bin/bash

echo "ðŸš€ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° Ðº Ð´ÐµÐ¿Ð»Ð¾ÑŽ Ð½Ð° Railway..."

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
if [ ! -f "requirements.railway.txt" ]; then
    echo "âŒ Ð¤Ð°Ð¹Ð» requirements.railway.txt Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
    exit 1
fi

if [ ! -f "Dockerfile" ]; then
    echo "âŒ Ð¤Ð°Ð¹Ð» Dockerfile Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½"
    exit 1
fi

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ Ð¾ÑÐ½Ð¾Ð²Ð½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð´Ð»Ñ Railway
echo "ðŸ“¦ Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½ÑƒÑŽ ÐºÐ¾Ð¿Ð¸ÑŽ requirements.txt..."
if [ -f "requirements.txt" ]; then
    cp requirements.txt requirements.txt.backup
fi

# Ð—Ð°Ð¼ÐµÐ½ÑÐµÐ¼ requirements.txt Ð½Ð° Railway-Ð²ÐµÑ€ÑÐ¸ÑŽ
cp requirements.railway.txt requirements.txt

echo "âœ… Ð¤Ð°Ð¹Ð»Ñ‹ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½Ñ‹ Ð´Ð»Ñ Railway deployment"
echo ""
echo "ðŸ“‹ Ð¡Ð»ÐµÐ´ÑƒÑŽÑ‰Ð¸Ðµ ÑˆÐ°Ð³Ð¸:"
echo "1. Ð£Ð±ÐµÐ´Ð¸Ñ‚ÐµÑÑŒ, Ñ‡Ñ‚Ð¾ Ð²ÑÐµ Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ñ‹Ðµ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½Ñ‹ Ð² Railway:"
echo "   - BOT_TOKEN"
echo "   - OPENAI_API_KEY"
echo "   - TELEGRAM_CHANNEL_ID"
echo "   - DATABASE_SECRET_KEY (Ð¼Ð¾Ð¶Ð½Ð¾ Ð¾ÑÑ‚Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ñ‹Ð¼ Ð´Ð»Ñ Railway)"
echo "   - LOG_LEVEL=INFO"
echo ""
echo "2. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ Ð´ÐµÐ¿Ð»Ð¾Ð¹ Ð² Railway"
echo ""
echo "3. ÐŸÐ¾ÑÐ»Ðµ Ð´ÐµÐ¿Ð»Ð¾Ñ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ restore.railway.sh Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²"

# Ð¡Ð¾Ð·Ð´Ð°ÐµÐ¼ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ
cat > restore.railway.sh << 'EOF'
#!/bin/bash
echo "ðŸ”„ Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²..."

if [ -f "requirements.txt.backup" ]; then
    mv requirements.txt.backup requirements.txt
    echo "âœ… requirements.txt Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½"
else
    echo "âš ï¸  Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð°Ñ ÐºÐ¾Ð¿Ð¸Ñ requirements.txt Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½Ð°"
fi

echo "âœ… Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹"
EOF

chmod +x restore.railway.sh

echo "âœ… Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ¾Ð·Ð´Ð°Ð½: restore.railway.sh"