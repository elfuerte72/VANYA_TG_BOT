# План разработки Telegram‑бота для расчёта КБЖУ

## 1. Цель проекта
Разработать Telegram‑бота, который единожды для каждого подписчика фитнес‑канала рассчитывает персональные показатели КБЖУ (калории, белки, жиры, углеводы) по формуле Бенедикта и формирует детальный план питания на 3–4 приёма пищи в зависимости от суточной калорийности.

---

## 2. Заинтересованные стороны
- **Заказчик:** фитнес‑тренер, владелец Telegram‑канала.
- **Пользователи:** подписчики Telegram‑канала (клиенты тренера), получающие одноразовый расчёт.

---

## 3. Функциональные требования

### 3.1 Проверка доступа
1. При первом обращении к боту проверять, является ли пользователь подписчиком указанного канала.
2. Разрешить начало диалога только подписчикам.

### 3.2 Единоразовый расчёт
1. Каждый пользователь может пройти процедуру расчёта **только один раз**.
2. После выдачи результата сохранять `telegram_id` и флаг `calculated = true`.
3. При повторном обращении выводить: «Вы уже получили расчёт КБЖУ».

### 3.3 Диалоговый сценарий
1. **Старт:** команда `/start` или кнопка «▶️ Запустить расчёт».
2. **Сбор параметров:** бот поочерёдно спрашивает:
   - Пол (варианты: «Мужской», «Женский»)
   - Возраст (полных лет)
   - Рост (см)
   - Вес (кг)
   - Уровень активности (варианты: «Низкий», «Средний» (по умолчанию), «Высокий»)
3. Если пользователь пропускает выбор активности — применить коэффициент **1.55**.
4. После ввода всех данных подтверждать корректность с возможностью редактирования до расчёта.

### 3.4 Алгоритм расчёта
1. Рассчитать базовую скорость метаболизма (BMR) по формуле Бенедикта:
   - Для мужчин: `BMR = 66.47 + 13.75 × вес(кг) + 5.0 × рост(см) – 6.76 × возраст(лет)`
   - Для женщин: `BMR = 655.1 + 9.56 × вес(кг) + 1.85 × рост(см) – 4.68 × возраст(лет)`
2. Умножить BMR на коэффициент активности → суточная норма калорий.
3. Распределение приёмов пищи:
   - **< 2000 ккал** → 3 приёма
   - **≥ 2000 ккал** → 4 приёма
4. Макронутриенты рассчитывать по стандартным процентным долям (например, 20% белков, 25% жиров, 55% углеводов) или настраиваемым при последующих релизах.

### 3.5 Вывод результата
1. Отправка текста с итоговыми значениями:
   - Ккал/сутки: `XXXX`
   - Белки: `XX г`
   - Жиры: `XX г`
   - Углеводы: `XX г`
2. План питания «по цифрам»: разбивка КБЖУ на 3 или 4 приёма (пример меню без продуктов, только цифры).
3. Опционально: базовый рекомендательный комментарий («Для достижения цели похудения/набора массы…»).

---

## 4. Нефункциональные требования
- **Время отклика:** ≤ 3 секунд.
- **Надёжность:** устойчивость к «бомбардировкам» запросами (игнорировать повторные обращения).
- **Безопасность:**
  - Токены API в переменных окружения.
  - Хранение данных пользователей в зашифрованной SQLite или аналогичной БД.
- **Логирование:** все ключевые шаги диалога и ошибки пишутся в лог-файл.

---

## 5. Технологический стек и интеграции
- **Язык:** Python 3.x
- **Telegram‑бот:** aiogram
- **AI‑сервис:** OpenAI ChatGPT 4.1 nano через OpenAI API
- **Хранилище:** SQLite (файл `users.db`) или альтернативы с шифрованием
- **Конфигурация:** через `pyproject.toml` (Poetry/PDM) и `.env` для секретов

---

## 6. Сроки реализации
- **Суммарно:** 2–3 рабочих дня
- **Разбивка:**
  - Подготовка: 0.5 дня
  - Проектирование: 0.5 дня
  - MVP-разработка: 1 день
  - Интеграция AI: 0.5 дня
  - Тестирование: 0.5 дня
  - Деплой и мониторинг: 0.5 дня

---

## 7. Дополнительные уточнения
- Порог 2000 ккал и макродоли можно менять по запросу.
- В будущем возможна адаптация под аллергенность и предпочтения.
- GDPR-соблюдение при расширении функционала.
